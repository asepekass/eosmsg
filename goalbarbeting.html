<!DOCTYPE html>
<html>

	<head>

		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>GoalBarClub - Simple Game</title>
		<!-- <link rel="shortcut icon" href="favicon.ico"> -->

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">


	</head>

	<body>

		<div class="container-fluid">
			<br/>
			<!-- Claim regawards -->
			<div class="row"  id="divclaim">
				<div class="col-10 offset-1">
					<div class="jumbotron">
						<h1>Balance to claim: <span id="toclaim">2.0000 EOS</span></h1>
						<a class="btn btn-primary btn-lg" href="javascript:alert(getCurrentAccount());" role="button">Claim</a>
					</div>
				</div>
			</div>

			<!-- Open games regawards -->
			<div class="row"  id="listgames">
				<div class="col-12">
					<h3>Games open to bet</h3>
					<div class="row" id="listgames">
					</div>
				</div>
			</div>

		</div>

		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/eosjs@16.0.0/lib/eos.min.js" integrity="sha512-vNyLnOEb7uFmEtVbLnyZQ9/k4zckM2Vu3jJOKq6XfWEVZG0yKcjDExVN4EQ7e3F+rePWRncMolI2xFi/3qo62A==" crossorigin="anonymous"></script>
		<script src="eosmsg.js"></script>

	</body>

	<script>
$(document).ready(function() {
	initGameList();
});
	</script>


	<script>
//// EOS ////////////
var {
	format,
	api,
	ecc,
	json,
	Fcbuffer
} = Eos.modules;

chain = {
	mainnet: 'aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906',
	testnet: '038f4b0fc8ff18a4f0842a8f0564611f6e96e8535901dd45e43ac8691a1c4dca',
	sysnet: 'cf057bbfb72640471fd910bcb67639c22df9f92470936cddc1ade0e2f2e7dc4f'
};

/**
  Other httpEndpoint's: https://www.eosdocs.io/resources/apiendpoints
 */
eosconfig = {
	httpEndpoint: 'http://192.168.0.105:8800',
	chainId: chain.sysnet,
	///httpEndpoint: 'https://api.eoslaomao.com',
	///chainId: chain.mainnet,
	broadcast: true,
	verbose: false,
};

var contract_account = "ctgbarbeting";
eos = Eos(eosconfig);

function initGameList() {
	eos.getTableRows({
		"json": true,
		"scope": contract_account,
		"code": contract_account,
		"table": "game",
		"limit": 100,
	}).then(result => {
		console.log(result);

		for (var i in result.rows) { 
			var g = result.rows[i];
			var Min = g.value_min.substring(0, g.value_min.length - 3) * 10000;
			var Max = g.value_max.substring(0, g.value_max.length - 3) * 10000;
			var Step = (Max - Min) / 20; 	

			$("#listgames").append("<div class='col-12'><div class='card text-center'>" +
					"   <div class='card-header'>" +
					"      "+g.team1+ " X " + g.team2 +
					"   </div> "+
					"   <div class='card-body'>"+
					"      <h5 class='card-title'>" + g.description + " (" + g.fee + " %) </h5>"+
					" <div id='tobet" + i + "'>"+
					"	   <p class='card-text'><b>Min:</b> " + g.value_min + " <b>Max:</b> " + g.value_max + "</p>"+
					"       <label for='amount"+ i +"'>Amount: <span id='valbet" + i + "'>" + Min / 10000 + "</span> EOS</label>"+
					"       <input type='range' class='custom-range' min='" + Min +"' max='" + Max+ "' step='" + Step + "' id='amount" + i + "' value='" + Min + "'" + 
					" onchange='var v = $(\"\#amount\" + " + i + ").val(); $(\"\#valbet\" + " + i + ").html(v/10000); " +
					"'>"+
					"  <p> "+g.team1+ " <input type='number' value='0' id='oscore" + g.id + "'>  X <input type='number' value='0' id='tscore" + g.id + "'> " + g.team2 + "</p>" +

					"<a class='btn btn-primary btn-lg' href='javascript:bet(" + g.id + ");' role='button' >Bet</a> " +

					" </div>" +
					"   </div> "+
					"   <div class='card-footer text-muted'> "+
					"	  Bets until: " + g.bet_until+
					"    </div>"+
					"</div></div>" ); 

		}
		
		adjustIFrameHeigth(document.body.scrollHeight);
	}).catch(function(exception) {
		if (exception) {
			alert(exception);
		}
	});
}

function bet(idgame) {
	var amount = format.DecimalUnimply($("#valbet" + idgame).html() * 10000, 4) + " EOS";
	var sc1 = $("#oscore"+idgame).val();
	var sc2 = $("#tscore"+idgame).val();

	transfer("ctgbarbeting", amount, "" + idgame + "," + sc1 + "," + sc2);
}

	</script>

</html>
